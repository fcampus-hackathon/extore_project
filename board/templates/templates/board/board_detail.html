{% extends 'base.html' %}
{% block title %}
{% endblock %}

{% block content %}
<hr>
<nav class="navbar navbar-expand-lg navbar-light bg-white text-center">
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav extore mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="{% url 'board:board_list' board.group %}">Free Talk <span class="sr-only">(current)</span></a>
      </li>
        <li class="nav-item active">
        <a class="nav-link" href="{% url 'extore:extorelist' %}">Post <span class="sr-only">(current)</span></a>
      </li>
        <li class="nav-item active">
        <a class="nav-link" href="{% url 'extore:extorelist' %}">Last Memory <span class="sr-only">(current)</span></a>
      </li>
        <li class="nav-item active">
        <a class="nav-link" href="{% url 'extore:extorelist' %}">Schedule <span class="sr-only">(current)</span></a>
      </li>

    </ul>
  </div>
</nav>

<div class="row">
   <div class="col"></div>
   <div class="col-6">
       {{board}} {{board.text|safe}} {{object.author}}<br>
       <hr>
       <form id="comment_form" action="{% url 'board:comment_create' board.id %}" method="post" enctype="multipart/form-data">
           {% csrf_token %}
           {{comment_form.as_p}}
           <input type="submit" value="Comment" class="btn btn-outline-primary">
       </form>

       {% include 'board/comment_list.html' %}

   </div>
   <div class="col"></div>
</div>

    {{board}}{{board.author}}{{board.created}}<br>
    {{board.text|safe}}
    <a href="{% url 'board:board_list' board.group %}">게시물 목록 가기</a>

<style>
    div#navbarSupportedContent{z-index:9999;}

    .navbar-nav.extore {
        margin-top: -10px;
        position: absolute;
        left: 50%;
        transform: translatex(-50%);
    }
    .navbar.navbar-expand-lg{
        height: 40px;
    }
</style>

{% endblock %}

{% block extra_script %}
<script type="text/javascript">
$(function() {
    $('#comment_form').submit(function(e) {
        $('input[name="is_ajax"]').val("1");
        url = $(this).attr('action');
        params = $(this).serialize(); //현재 값들을 하나로 모은다
        $.ajax({
            url:url,
            method:"POST",
            data:params
        }).done(function(data) {
            if(data.notLogin){
                var move = confirm('로그인 페이지로 이동하시겠습니까?');
                if(move == true){
                    window.location.href = '{% url 'accounts:login' %}';
                }
            }
            // 댓글 입력창 내용 비우기
            $('#id_text').val("");
            $('#comment_list tbody').prepend(data.html); // tbody 시작 지점에 요소 끼워넣기
            // $('#comment_list tbody').append(tr); // tbody 끝 지점에 요소 끼워넣기
            // is_ajax 값 초기화
            $('input[name="is_ajax"]').val("");
        });
        location.reload();
        return false; //페이지를 갔다오지않고 댓글이 남겨지게 페이지 이동을 막는다
    });
    $('.btn_comment_delete').click(function(e) {
        e.preventDefault();
        var input = confirm('댓글을 삭제하시겠습니까?');
        if (input==true) {
            //alert('댓글을 삭제하였습니다.');
            comment = $(this).parents('tr'); // 버튼을 감싸고 있는 tr 찾기
            url = $(this).attr('href')+"?is_ajax=1"; // ajax호출임을 구분할 수 있게 값 추가
            $.ajax({
                url:url
            }).done(function(data) {
                if (data.works) {
                    comment.remove(); // 해당 객체 지우기
                }
            });
        }
    });
    $('.btn_comment_update').click(function(e) {
        e.preventDefault();
        url = $(this).attr('href')+'?is_ajax=1';
        comment = $(this).parent().siblings('.comment_text'); // 원래 댓글을 찾음
        input = "<input type='text' class='update_text' value='"+comment.text()+"'>";
        comment.html(input);
        $('.update_text').keypress(function(e){
            if (e.keyCode==13) {
                text = $(this).val();
                $.ajax({
                    url:url,
                    data:{
                        text:text
                    }
                }).done(function(data) {
                    if(data.works) {
                        comment.text(text);
                    }
                });
            }
        });
        return false;
        text = prompt('수정될 댓글 내용을 입력하세요.', comment.text()); // 원래 댓글을 프롬프트로 보여줌
        if (text==null) return false; // 입력 취소면 함수 종료
        $.ajax({
            url:url,
            data:{
                text:text
            }
        }).done(function(data) {
            if(data.works) {
                comment.text(text);
            }
        });
    });
});
</script>
{% endblock %}